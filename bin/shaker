#! /bin/bash
#
# shaker
# Copyright (C) 2013 xavier <xavier@laptop-300E5A>
#
# Distributed under terms of the MIT license.
#
# vi: set ft=bash :


source utils.sh
source shaker_lib.sh


log "       Shaker       "
log "____________________"
log ""


function usage() {
    log "Usage: $0 command [OPTIONS]"
}


#TODO help
while getopts ":i:m:p:u:w:" optname
do
  case "$optname" in
    "i")
        image=$OPTARG
        ;;
    "m")
        memory=$OPTARG
        ;;
    "p")
        project=$OPTARG
        ;;
    "u")
        github_user=$OPTARG
        ;;
    "w")
        where=$OPTARG
        ;;
    "?")
        echo "Unknown option $OPTARG"
        ;;
    ":")
        echo "No argument value for option $OPTARG"
        ;;
    *)
        # Should not occur
        echo "Unknown error while processing options"
        ;;
  esac
done


arguments=()
for p in "${@:$OPTIND}"
    do
    #echo "$p"
    arguments+=($p)
done


if [ ! $project ]; then
    die "You have to sepcifie which project you are working on"
fi


case "${arguments[0]}" in

    setup)
        # Set default values
        github_user=${github_user:-Gusabi}
        image=${image:-precise64}
        memory=${memory:-1024}
        create_instance $project $github_user $image $memory

    ;;

    connect)
        connect $project

    ;;

    sync)
        # shaker sync from/to project
        where=${where:-from}
        synchronize_project $where

    ;;

    box)
        # Remote vagrant commands
        vagrant_command=${arguments[1]}
        remote_vagrant $project $vagrant_command

    ;;

    *)
        usage
        die "..."
    ;;

esac
